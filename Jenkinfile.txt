pipeline {

    agent any

    tools {

        maven 'Maven3'

    }

    stages {

        stage('Checkout') {

            steps {

                git branch: 'main', url: 'https://github.com/Mukulchauhan2905/AutomationExitTestAssignment.git'

            }

        }

        stage('Build') {

            steps {


                bat 'mvn clean'

            }

        }
        
        stage('Compile') {
        
                    steps {
        
        
                        bat 'mvn compile'
        
                    }
        
                }

        stage('Test') {

            steps {

                bat 'mvn test' 

            }

        }

    }

    post {

        success {

            echo 'Pipeline succeeded! You can celebrate now.'
            cleanTemporaryFiles()

        }

        failure {

            echo 'Pipeline failed! Time to investigate.'
            cleanTemporaryFiles()

        }

    }
}

    def cleanTemporaryFiles() {
    // Remove the 'target' folder generated by Maven
    // Make sure to handle any exceptions that may occur during cleanup
    try {
        bat 'rmdir /S /Q target'
    } catch (Exception e) {
        echo "Error occurred while cleaning up target folder: ${e.message}"
    }
}
